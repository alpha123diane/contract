<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Patrick Web3 Marketplace</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>

<body style="margin:0;font-family:Arial;background:#0f2027;color:white;">

<div style="padding:30px;max-width:900px;margin:auto;">

<h2>ðŸš€ Patrick Advanced Marketplace</h2>

<button onclick="connectWallet()" style="padding:10px 20px;background:#00c9ff;border:none;border-radius:8px;">Connect</button>

<p id="wallet"></p>
<p id="ethBalance"></p>
<p id="tokenBalance"></p>

<hr>

<input id="itemId" placeholder="Item ID" style="padding:8px;">
<button onclick="buyETH()">Buy with ETH</button>
<button onclick="buyToken()">Buy with Token</button>

<h3>ðŸ“Š Live Blockchain Events</h3>
<ul id="events"></ul>

</div>

<script>

const SEPOLIA_PARAMS = {
 chainId: "0xaa36a7",
 chainName: "Sepolia Testnet",
 nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},
 rpcUrls:["https://rpc.sepolia.org"],
 blockExplorerUrls:["https://sepolia.etherscan.io"]
};

const marketplaceAddress = "PASTE_MARKETPLACE";
const tokenAddress = "PASTE_TOKEN";

const marketplaceABI = [
 "function getItemPrice(uint256) view returns(uint256)",
 "function purchaseWithETH(uint256) payable",
 "function purchaseWithToken(uint256)",
 "event ItemPurchased(address buyer,uint256 itemId,uint256 price,string paymentType)"
];

const tokenABI = [
 "function balanceOf(address) view returns(uint256)",
 "function approve(address,uint256) returns(bool)"
];

let provider, signer, market, token;

async function connectWallet(){

 if(!window.ethereum) return alert("Install MetaMask");

 await window.ethereum.request({method:"eth_requestAccounts"});

 try{
   await window.ethereum.request({
     method:"wallet_switchEthereumChain",
     params:[{chainId:"0xaa36a7"}]
   });
 }catch{
   await window.ethereum.request({
     method:"wallet_addEthereumChain",
     params:[SEPOLIA_PARAMS]
   });
 }

 provider = new ethers.providers.Web3Provider(window.ethereum);
 signer = provider.getSigner();

 market = new ethers.Contract(marketplaceAddress, marketplaceABI, signer);
 token = new ethers.Contract(tokenAddress, tokenABI, signer);

 const addr = await signer.getAddress();
 document.getElementById("wallet").innerText = addr;

 updateBalances();
 listenEvents();
}

async function updateBalances(){
 const addr = await signer.getAddress();
 const eth = await provider.getBalance(addr);
 const tok = await token.balanceOf(addr);

 document.getElementById("ethBalance").innerText =
  "ETH: "+ethers.utils.formatEther(eth);

 document.getElementById("tokenBalance").innerText =
  "Token: "+ethers.utils.formatEther(tok);
}

async function buyETH(){
 const id = document.getElementById("itemId").value;
 const price = await market.getItemPrice(id);
 await market.purchaseWithETH(id,{value:price});
}

async function buyToken(){
 const id = document.getElementById("itemId").value;
 const price = await market.getItemPrice(id);

 await token.approve(marketplaceAddress, price);
 await market.purchaseWithToken(id);
}

function listenEvents(){
 market.on("ItemPurchased",(buyer,itemId,price,type)=>{
   const li = document.createElement("li");
   li.innerText =
    buyer+" bought Item "+itemId+" with "+type+
    " ("+ethers.utils.formatEther(price)+")";
   document.getElementById("events").appendChild(li);
 });
}

</script>
</body>
</html>
